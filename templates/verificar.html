{% extends "base.html" %}
{% block title %}Verificar equipo{% endblock %}
{% block content %}

<div class="form-card">
  <h2>Verificar estado de equipo</h2>

  <form method="get">
    <label for="nombre">Selecciona cliente:</label>
    <select id="nombre" name="nombre" required>
      <option value="">-- Selecciona un cliente --</option>
      {% for e in equipos %}
        <option value="{{ e.id }}" {% if request.GET.nombre == e.id|stringformat:"s" %}selected{% endif %}>
          {{ e.cliente.nombre_completo }} — {{ e.tipo }}
        </option>
      {% endfor %}
    </select>
    <button type="submit" class="btn">Ingresar</button>
  </form>

  {% if equipo %}
    <div style="margin-top: 20px; text-align: left;">
      <h3>Equipo de {{ equipo.cliente.nombre_completo }}</h3>
      <p><strong>Tipo:</strong> {{ equipo.tipo }}</p>
      <p><strong>Problema informado:</strong> {{ equipo.problema_reportado }}</p>

      {% if diag %}
        <p><strong>Técnico asignado:</strong> 
          {% if diag.tecnico %}
            {{ diag.tecnico.username }}
          {% else %}
            No asignado
          {% endif %}
        </p>
        <p><strong>Estado diagnóstico:</strong> {{ diag.get_estado_display }}</p>
      {% endif %}

      {% if entrega %}
        <p><strong>Estado entrega:</strong> 
          <span style="color: green; font-weight: bold;">{{ entrega.estado }}</span>
        </p>
        <p><strong>Observaciones:</strong> {{ entrega.observaciones }}</p>
        <a href="{% url 'comprobante' equipo.id %}" class="btn">Ver comprobante</a>
      {% else %}
        <p>No tiene entrega registrada aún.</p>
        <a href="{% url 'reporte_entrega' %}?nombre={{ equipo.id }}" class="btn">Registrar entrega</a>
      {% endif %}
    </div>
  {% elif equipo is not none %}
    <p>No se encontró información del cliente.</p>
  {% endif %}
</div>

{% endblock %}